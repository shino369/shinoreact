"use strict";(self.webpackChunkshinoreact=self.webpackChunkshinoreact||[]).push([[316],{54316:function(e,t,n){n.r(t),n.d(t,{ChatPage:function(){return L}});var i=n(42982),s=n(74165),o=n(1413),a=n(15861),r=n(70885),c=n(72791),d=n(59434),l=n(39478),m=n(24805),u=n(12075),h=n(82637),p=n(76277),f=n(8100),x=n(97796),b=n(28288),v=n(55705),g=n(81724),j=n(9062),w=n(18643),y=n(763),N=n.n(y),k=n(80922),Z=n(79884),C=n(60196),R=n(75985),I=n(80184),O=g.Ry().shape({msg:g.Z_().required("required")}),z="#fff",S="3.5rem",E=15,L=function(){var e=(0,d.v9)((function(e){return e.auth})).user,t=(0,d.I0)(),n=(0,m.useMediaQuery)({query:"(max-width: 576px)"}),g=(0,c.useState)([]),y=(0,r.Z)(g,2),L=(y[0],y[1],(0,c.useState)(!1)),J=(0,r.Z)(L,2),T=J[0],U=J[1],H=(0,c.useState)(),A=(0,r.Z)(H,2),P=A[0],X=A[1],D=(0,c.useState)(!n),q=(0,r.Z)(D,2),M=q[0],Q=q[1],B=(0,c.useState)({id:"public",name:"public"}),G=(0,r.Z)(B,2),K=G[0],Y=G[1],F=(0,c.useState)([]),V=(0,r.Z)(F,2),W=V[0],_=V[1],$=(0,c.useState)([]),ee=(0,r.Z)($,2),te=ee[0],ne=ee[1],ie=(0,c.useState)({action:"",isOpen:!1}),se=(0,r.Z)(ie,2),oe=se[0],ae=se[1],re=(0,c.useState)(n?"7rem":"1rem"),ce=(0,r.Z)(re,2),de=ce[0],le=ce[1],me=(0,c.useState)(1),ue=(0,r.Z)(me,2),he=ue[0],pe=ue[1],fe=(0,c.useState)((0,j.IO)((0,j.hJ)(w.db,"messages"),(0,j.Xo)("createdAt"),(0,j.b9)(100))),xe=(0,r.Z)(fe,2),be=xe[0],ve=xe[1],ge=(0,c.useRef)(null),je=(0,c.useRef)(null);(0,c.useEffect)((function(){"public"===K.id?ve((0,j.IO)((0,j.hJ)(w.db,"messages"),(0,j.Xo)("createdAt"),(0,j.b9)(100))):ve((0,j.IO)((0,j.hJ)(w.db,"rooms",K.id,"messages"),(0,j.Xo)("createdAt"),(0,j.b9)(100)))}),[K]);var we=(0,k.sQ)(be),ye=(0,c.useCallback)(function(){var t=(0,a.Z)((0,s.Z)().mark((function t(n){var i,a,r,c,d,l,m,u;return(0,s.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return i=(0,j.IO)((0,j.hJ)(w.db,"rooms"),(0,j.ar)("members","array-contains",e.uid)),t.next=3,(0,j.PL)(i);case 3:if(a=t.sent,r=[],a.forEach((function(e){r.push((0,o.Z)({id:e.id},e.data()))})),"public"===K.id){t.next=18;break}return c=r.find((function(e){return e.id===K.id})),d=(0,j.IO)((0,j.hJ)(w.db,"users"),(0,j.ar)("uid","in",c.members)),t.next=11,(0,j.PL)(d);case 11:l=t.sent,m=[],l.forEach((function(e){m.push((0,o.Z)({id:e.id},e.data()))})),_(m),console.log(m),t.next=19;break;case 18:"public"===K.id&&(u=N().uniqBy(n,"uid").map((function(e){return{photoURL:e.photoURL,displayName:e.displayName,uid:e.uid}})),_(u));case 19:ne(r),console.log("triggered");case 21:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),[K]);(0,c.useEffect)((function(){n?window.scrollTo({top:document.body.scrollHeight,behavior:"smooth"}):je.current.scrollTo({top:je.current.scrollHeight,behavior:"smooth"}),ye(we)}),[we,ye]),(0,c.useEffect)((function(){t((0,l.wC)("chat"))}),[t]),(0,c.useEffect)((function(){var e=N().debounce((function(e){if(n){var t=window.scrollY,i=document.body.scrollHeight,s=window.innerHeight;U(t+s+200<i)}}),100);return window.addEventListener("scroll",e),function(){window.removeEventListener("scroll",e)}}),[]);var Ne=N().debounce((function(e){if(!n){var t=e.target.scrollTop,i=e.target.scrollHeight,s=e.target.clientHeight;U(t+s+200<i)}}),100),ke=(0,c.useCallback)(function(){var t=(0,a.Z)((0,s.Z)().mark((function t(n){var i;return(0,s.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,(0,j.ET)((0,j.hJ)(w.db,"rooms"),{name:n,members:[e.uid]});case 2:return i=t.sent,t.next=5,(0,j.ET)((0,j.hJ)(w.db,"rooms",i.id,"messages"),{uid:e.uid,displayName:e.displayName,photoURL:e.photoURL,message:"Welcome to the room",createdAt:j.EK.now()});case 5:ae({action:"",isOpen:!1}),Y({id:i.id,name:n});case 7:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),[e]),Ze=(0,c.useCallback)(function(){var t=(0,a.Z)((0,s.Z)().mark((function t(o){var a,r,c;return(0,s.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return a=(0,j.JU)(w.db,"rooms",o),t.next=3,(0,j.QT)(a);case 3:if(!(r=t.sent).exists()){t.next=16;break}if(!(c=r.data().members).includes(e.uid)){t.next=11;break}Y({id:r.id,name:r.data().name}),ae({action:"",isOpen:!1}),t.next=14;break;case 11:return t.next=13,(0,j.r7)(a,{members:[].concat((0,i.Z)(c),[e.uid])});case 13:Y({id:r.id,name:r.data().name});case 14:t.next=17;break;case 16:(0,R.Am)("ERROR 404: Room not found",{theme:"colored",position:n?"top-center":"top-right",className:"opacity-toast text-white"});case 17:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),[e]),Ce=(0,c.useCallback)((0,a.Z)((0,s.Z)().mark((function t(){var n,i;return(0,s.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=(0,j.JU)(w.db,"rooms",K.id),i=W.filter((function(t){return t.uid!==e.uid})),t.next=4,(0,j.r7)(n,{members:i});case 4:Y({id:"public",name:"Public"});case 5:case"end":return t.stop()}}),t)}))),[W]),Re=function(){var t=(0,a.Z)((0,s.Z)().mark((function t(n,i){var o,a,r,c;return(0,s.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(o=n.msg,!((a=o.trim()).length>0)){t.next=8;break}return r="public"===K.id?(0,j.hJ)(w.db,"messages"):(0,j.hJ)(w.db,"rooms",K.id,"messages"),c={uid:e.uid,displayName:e.displayName,photoURL:e.photoURL,message:a,createdAt:j.EK.now()},t.next=7,(0,j.ET)(r,c);case 7:t.sent;case 8:i.resetForm();case 9:case"end":return t.stop()}}),t)})));return function(e,n){return t.apply(this,arguments)}}(),Ie=(0,c.useCallback)(function(){var e=(0,a.Z)((0,s.Z)().mark((function e(t){return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("public"!==K.id){e.next=6;break}return e.next=3,(0,j.oe)((0,j.JU)(w.db,"messages",t));case 3:e.sent,e.next=9;break;case 6:return e.next=8,(0,j.oe)((0,j.JU)(w.db,"rooms",K.id,"messages",t));case 8:e.sent;case 9:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),[K]);return(0,I.jsxs)("div",{className:"d-flex justify-content-center chatroom-wrapper px-sm-4 pt-sm-3 pb-sm-5",children:[(0,I.jsx)("div",{className:"".concat(n?"d-none":""," start-0 h-100 d-flex align-items-start justify-content-start bg-room overflow-hidden"),children:(0,I.jsxs)("div",{className:"p-0 d-flex flex-column h-100 justify-content-start position-relative",children:[(0,I.jsxs)("div",{className:"d-flex align-items-center",style:{minHeight:S},children:[(0,I.jsx)("div",{onClick:function(){ae({action:"add",isOpen:!0})},className:"".concat(M?"":"d-none"," btn ms-1 bg-dark mt-1 pointer hover-opacity p-0 d-flex justify-content-center align-items-center"),style:{borderRadius:"50%",width:30,height:30,zIndex:20},children:(0,I.jsx)(h.Z,{width:E,height:E,fill:z})}),(0,I.jsx)("div",{onClick:function(){ae({action:"join",isOpen:!0})},className:"".concat(M?"":"d-none"," btn ms-1 bg-dark mt-1 pointer hover-opacity p-0 d-flex justify-content-center align-items-center"),style:{borderRadius:"50%",width:30,height:30,zIndex:20},children:(0,I.jsx)(p.Z,{width:E,height:E,fill:z})})]}),(0,I.jsx)("div",{className:"transition me-1 overflow-auto border-bottom-chat",style:{width:"12rem",fontSize:"0.75rem",height:"calc(50% - 3.5rem)",left:"0px",zIndex:10},children:[{name:"public",id:"public"}].concat((0,i.Z)(te)).map((function(e,t){return(0,I.jsxs)("div",{className:"mb-1 text-white p-0 text-start w-100",children:[(0,I.jsxs)("div",{onClick:function(){K.id!==e.id&&Y({id:e.id,name:e.name}),n&&Q(!1)},className:"px-2 bg-chat pointer d-flex w-100 justify-content-between align-items-center",children:[(0,I.jsx)("div",{className:"col",children:e.name}),(0,I.jsx)("div",{className:"col-2 py-2 d-flex justify-content-center",children:(0,I.jsx)(x.Z,{width:20,height:20,fill:z})})]}),"public"!==e.id&&(0,I.jsxs)("div",{className:"px-2 d-flex align-items-center py-2",children:[(0,I.jsx)("div",{className:"text-break col",children:e.id}),(0,I.jsx)("div",{onClick:function(){navigator.clipboard.writeText(e.id),(0,R.Am)("Room ID Copied to clipboard",{theme:"colored",position:"top-right",className:"opacity-toast text-white"})},className:"col-2 d-flex justify-content-center pointer",children:(0,I.jsx)(f.Z,{width:E,height:E,fill:z})})]})]},t)}))}),(0,I.jsxs)("div",{className:"text-white",style:{flexGrow:1},children:[(0,I.jsxs)("div",{className:"my-2 ms-2 d-flex align-items-center justify-content-between",style:{fontSize:"0.75rem"},children:["Member :",(0,I.jsx)("div",{children:(0,I.jsx)("div",{onClick:function(){ae({action:"leave",isOpen:!0})},className:"".concat("public"===K.id?"d-none":""," btn me-1 bg-dark pointer hover-opacity p-0 d-flex justify-content-center align-items-center"),style:{borderRadius:"50%",width:30,height:30,zIndex:20},children:(0,I.jsx)(b.Z,{width:E,height:E,fill:z})})})]}),(0,I.jsx)("div",{children:W.map((function(e,t){return(0,I.jsx)("img",{style:{width:"1.5rem",height:"1.5rem",borderRadius:"50%",marginLeft:"0.5rem"},src:e.photoURL,alt:"avatar"},t)}))})]})]})}),(0,I.jsxs)("div",{className:"chatroom shadow d-flex flex-column position-relative ".concat(n?"":"overflow-hidden"),children:[(0,I.jsx)("div",{onClick:function(){Q(!M)},className:"".concat(M&&n?"":"d-none"," backdrop position-absolute w-100 h-100"),style:{zIndex:1010}}),(0,I.jsx)("div",{className:"".concat(n?"position-fixed":"d-none"," start-0 h-100 d-flex align-items-start justify-content-start"),style:{zIndex:1020},children:(0,I.jsxs)("div",{className:"p-0 d-flex ".concat(n?"flex-column align-items-center":"d-flex align-items-start"," h-100 justify-content-start position-relative"),children:[(0,I.jsxs)("div",{className:"d-flex align-items-center",children:[(0,I.jsx)("div",{onClick:function(){Q(!M)},style:{zIndex:20,minHeight:"30px"},className:"rounded-pill pointer badge p-2 mt-1 ms-1 shadow ".concat(M?"d-none":"bg-dark"),children:K.name}),(0,I.jsx)("div",{onClick:function(){ae({action:"add",isOpen:!0})},className:"".concat(M?"":"d-none"," btn ms-1 bg-chat mt-1 pointer hover-opacity p-0 d-flex justify-content-center align-items-center"),style:{borderRadius:"50%",width:30,height:30,zIndex:20},children:(0,I.jsx)(h.Z,{width:E,height:E,fill:z})}),(0,I.jsx)("div",{onClick:function(){ae({action:"join",isOpen:!0})},className:"".concat(M?"":"d-none"," btn ms-1 bg-chat mt-1 pointer hover-opacity p-0 d-flex justify-content-center align-items-center"),style:{borderRadius:"50%",width:30,height:30,zIndex:20},children:(0,I.jsx)(p.Z,{width:E,height:E,fill:z})})]}),(0,I.jsxs)("div",{className:"transition pe-1 shadow bg-primary position-absolute h-100",style:{transform:M?"translateX(0)":"translateX(-12rem)",width:"12rem",fontSize:"0.75rem",paddingTop:"4rem",left:"0px",zIndex:10},children:[(0,I.jsx)("div",{className:"h-50 border-bottom-chat overflow-auto",children:[{name:"public",id:"public"}].concat((0,i.Z)(te)).map((function(e,t){return(0,I.jsxs)("div",{className:"mb-1 text-white p-0 text-start w-100",children:[(0,I.jsxs)("div",{onClick:function(){K.id!==e.id&&Y({id:e.id,name:e.name}),n&&Q(!1)},className:"px-2 bg-chat pointer d-flex w-100 justify-content-between align-items-center",children:[(0,I.jsx)("div",{className:"col",children:e.name}),(0,I.jsx)("div",{className:"col-2 py-2 d-flex justify-content-center",children:(0,I.jsx)(x.Z,{width:20,height:20,fill:z})})]}),"public"!==e.id&&(0,I.jsxs)("div",{className:"px-2 d-flex align-items-center py-2",children:[(0,I.jsx)("div",{className:"text-break col",children:e.id}),(0,I.jsx)("div",{onClick:function(){navigator.clipboard.writeText(e.id),(0,R.Am)("Room ID Copied to clipboard",{theme:"colored",position:"top-center",className:"opacity-toast text-white"})},className:"col-2 d-flex justify-content-center pointer",children:(0,I.jsx)(f.Z,{width:E,height:E,fill:z})})]})]},t)}))}),(0,I.jsxs)("div",{className:"text-white",style:{flexGrow:1},children:[(0,I.jsxs)("div",{className:"my-2 ms-2 d-flex justify-content-between align-items-center",children:["Member :",(0,I.jsx)("div",{children:(0,I.jsx)("div",{onClick:function(){ae({action:"leave",isOpen:!0})},className:"".concat("public"===K.id?"d-none":""," btn me-1 bg-chat pointer hover-opacity p-0 d-flex justify-content-center align-items-center"),style:{borderRadius:"50%",width:30,height:30,zIndex:20},children:(0,I.jsx)(b.Z,{width:E,height:E,fill:z})})})]}),(0,I.jsx)("div",{children:W.map((function(e,t){return(0,I.jsx)("img",{style:{width:"1.5rem",height:"1.5rem",borderRadius:"50%",marginLeft:"0.5rem"},src:e.photoURL,alt:"avatar"},t)}))})]})]})]})}),(0,I.jsx)("div",{ref:ge,className:"room-title d-none d-sm-flex justify-content-center align-items-center border-bottom text-center shadow",style:{height:S,fontSize:"1rem"},children:K.name}),(0,I.jsx)("div",{onClick:function(){n?window.scrollTo({top:document.body.scrollHeight,behavior:"smooth"}):je.current.scrollTo({top:je.current.scrollHeight,behavior:"smooth"})},style:{borderRadius:"50%",opacity:T?1:0,transform:T?"translateY(0)":"translateX(100%)"},className:"".concat(n?"position-fixed":"position-absolute"," scroll-to pointer bg-dark transition mb-5 mb-sm-0 shadow"),children:(0,I.jsx)(Z.JO,{svg:!0,name:"arrow-down",size:20,color:"white"})}),(0,I.jsx)("div",{ref:je,onScroll:Ne,className:"room-content hideScroll pt-5 pt-sm-1",style:{paddingBottom:de},children:we.map((function(t,n){return(0,I.jsx)(Z.z5,{name:t.displayName,message:t.message,self:(null===e||void 0===e?void 0:e.uid)===(null===t||void 0===t?void 0:t.uid),avatar:t.photoURL,uid:t.uid,createdAt:t.createdAt,onPress:function(e){X({action:e,id:t.id}),ae({action:"delete",isOpen:!0})}},n)}))}),(0,I.jsx)("div",{className:"border-top pt-3 pb-5 pb-sm-3 input-fixed",style:{zIndex:30},children:(0,I.jsx)(v.J9,{initialValues:{msg:""},validationSchema:O,onSubmit:Re,children:function(e){e.values;return(0,I.jsxs)(v.l0,{className:"d-flex w-100 px-4",onChange:function(){},children:[(0,I.jsx)("div",{className:"col",children:(0,I.jsx)(Z.UP,{onInputChange:function(e){""!==e&&e.length>0&&function(e){var t=e>5?5:e;pe(t),n&&le("".concat(1.5*t+5.5,"rem")),setTimeout((function(){n?window.scrollTo({top:document.body.scrollHeight,behavior:"smooth"}):je.current.scrollTo({top:je.current.scrollHeight,behavior:"smooth"})}),50)}(e.split("\n").length)},style:{backgroundColor:"rgba(54, 57, 63, 0.8)",border:"none",caretColor:"white",color:"white",resize:"none"},name:"msg",placeholder:"Input something...",type:"textarea",showError:!1,rows:he})}),(0,I.jsx)("div",{className:"d-flex align-items-center",children:(0,I.jsx)("button",{className:"btn p-0",style:{borderRadius:"50%",border:"none"},type:"submit",children:(0,I.jsx)(u.Z,{width:30,height:30,fill:z})})}),(0,I.jsx)("div",{className:"mt-4 text-center"})]})}})})]}),(0,I.jsx)(C.Z,{open:oe.isOpen,title:"delete"===oe.action?"Confirm delete?":"add"===oe.action?"Add new room":"join"===oe.action?"Join room":"leave"===oe.action?"Leave room":"",withInput:["add","join"].includes(oe.action),message:"delete"===oe.action?"Deleted content cannot be recovered.":"add"===oe.action?"Please input room name.":"join"===oe.action?"Please input Room ID to join a room.":"leave"===oe.action?"Confirm to leave this room?":"",onCancel:function(){"delete"===oe.action&&X(void 0),ae({action:"",isOpen:!1})},onConfirm:function(e){switch(oe.action){case"delete":P&&"DELETE"===P.action&&Ie(P.id),X(void 0),ae({action:"",isOpen:!1});break;case"add":ke(e);break;case"join":Ze(e);break;case"leave":Ce()}}})]})}}}]);
//# sourceMappingURL=316.6941ef6c.chunk.js.map