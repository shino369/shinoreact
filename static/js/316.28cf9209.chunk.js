"use strict";(self.webpackChunkshinoreact=self.webpackChunkshinoreact||[]).push([[316],{54316:function(e,t,n){n.r(t),n.d(t,{ChatPage:function(){return H}});var i=n(42982),o=n(74165),s=n(1413),a=n(15861),r=n(70885),c=n(72791),l=n(59434),d=n(39478),m=n(24805),u=n(63264),h=n.n(u),p=n(12075),f=n(82637),x=n(76277),b=n(8100),g=n(97796),v=n(28288),w=n(65804),j=n(42636),y=n(55705),N=n(81724),k=n(9062),Z=n(74453),R=n(18643),C=n(763),U=n.n(C),I=n(80922),L=n(79884),z=n(60196),O=n(75985),S=n(80184),E=N.Ry().shape({msg:N.Z_()}),T="#fff",J="3.5rem",A=15,H=function(){var e=(0,l.v9)((function(e){return e.auth})).user,t=(0,l.I0)(),n=(0,m.useMediaQuery)({query:"(max-width: 576px)"}),u=(0,c.useState)([]),N=(0,r.Z)(u,2),C=(N[0],N[1],(0,c.useState)(!1)),H=(0,r.Z)(C,2),P=H[0],B=H[1],F=(0,c.useState)(),X=(0,r.Z)(F,2),D=X[0],M=X[1],W=(0,c.useState)(!n),_=(0,r.Z)(W,2),K=_[0],Q=_[1],q=(0,c.useState)({id:"public",name:"public"}),G=(0,r.Z)(q,2),Y=G[0],V=G[1],$=(0,c.useState)([]),ee=(0,r.Z)($,2),te=ee[0],ne=ee[1],ie=(0,c.useState)([]),oe=(0,r.Z)(ie,2),se=oe[0],ae=oe[1],re=(0,c.useState)({action:"",isOpen:!1}),ce=(0,r.Z)(re,2),le=ce[0],de=ce[1],me=(0,c.useState)(n?"7rem":"8rem"),ue=(0,r.Z)(me,2),he=ue[0],pe=ue[1],fe=(0,c.useState)(1),xe=(0,r.Z)(fe,2),be=xe[0],ge=xe[1],ve=(0,c.useState)((0,k.IO)((0,k.hJ)(R.db,"messages"),(0,k.Xo)("createdAt"),(0,k.b9)(100))),we=(0,r.Z)(ve,2),je=we[0],ye=we[1],Ne=(0,c.useState)([]),ke=(0,r.Z)(Ne,2),Ze=ke[0],Re=ke[1],Ce=function(e,t){console.log(e,t),Re(e)},Ue=(0,c.useRef)(null),Ie=(0,c.useRef)(null),Le=(0,Z.cF)();(0,c.useEffect)((function(){"public"===Y.id?ye((0,k.IO)((0,k.hJ)(R.db,"messages"),(0,k.Xo)("createdAt"),(0,k.b9)(100))):ye((0,k.IO)((0,k.hJ)(R.db,"rooms",Y.id,"messages"),(0,k.Xo)("createdAt"),(0,k.b9)(100)))}),[Y]);var ze=(0,I.sQ)(je),Oe=(0,c.useCallback)(function(){var t=(0,a.Z)((0,o.Z)().mark((function t(n){var i,a,r,c,l,d,m,u;return(0,o.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return i=(0,k.IO)((0,k.hJ)(R.db,"rooms"),(0,k.ar)("members","array-contains",e.uid)),t.next=3,(0,k.PL)(i);case 3:if(a=t.sent,r=[],a.forEach((function(e){r.push((0,s.Z)({id:e.id},e.data()))})),"public"===Y.id){t.next=18;break}return c=r.find((function(e){return e.id===Y.id})),l=(0,k.IO)((0,k.hJ)(R.db,"users"),(0,k.ar)("uid","in",c.members)),t.next=11,(0,k.PL)(l);case 11:d=t.sent,m=[],d.forEach((function(e){m.push((0,s.Z)({id:e.id},e.data()))})),ne(m),console.log(m),t.next=19;break;case 18:"public"===Y.id&&(u=U().uniqBy(n,"uid").map((function(e){return{photoURL:e.photoURL,displayName:e.displayName,uid:e.uid}})),ne(u));case 19:ae(r),console.log("triggered");case 21:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),[Y]);(0,c.useEffect)((function(){n?window.scrollTo({top:document.body.scrollHeight,behavior:"smooth"}):Ie.current.scrollTo({top:Ie.current.scrollHeight,behavior:"smooth"}),Oe(ze)}),[ze,Oe]),(0,c.useEffect)((function(){t((0,d.wC)("chat"))}),[t]),(0,c.useEffect)((function(){var e=U().debounce((function(e){if(n){var t=window.scrollY,i=document.body.scrollHeight,o=window.innerHeight;B(t+o+200<i)}}),100);return window.addEventListener("scroll",e),function(){window.removeEventListener("scroll",e)}}),[]);var Se=U().debounce((function(e){if(!n){var t=e.target.scrollTop,i=e.target.scrollHeight,o=e.target.clientHeight;B(t+o+200<i)}}),100),Ee=(0,c.useCallback)(function(){var t=(0,a.Z)((0,o.Z)().mark((function t(n){var i;return(0,o.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,(0,k.ET)((0,k.hJ)(R.db,"rooms"),{name:n,members:[e.uid]});case 2:return i=t.sent,t.next=5,(0,k.ET)((0,k.hJ)(R.db,"rooms",i.id,"messages"),{uid:e.uid,displayName:e.displayName,photoURL:e.photoURL,message:"Welcome to the room",createdAt:k.EK.now()});case 5:de({action:"",isOpen:!1}),V({id:i.id,name:n});case 7:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),[e]),Te=(0,c.useCallback)(function(){var t=(0,a.Z)((0,o.Z)().mark((function t(s){var a,r,c;return(0,o.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return a=(0,k.JU)(R.db,"rooms",s),t.next=3,(0,k.QT)(a);case 3:if(!(r=t.sent).exists()){t.next=17;break}if(!(c=r.data().members).includes(e.uid)){t.next=11;break}V({id:r.id,name:r.data().name}),de({action:"",isOpen:!1}),t.next=15;break;case 11:return t.next=13,(0,k.r7)(a,{members:[].concat((0,i.Z)(c),[e.uid])});case 13:V({id:r.id,name:r.data().name}),de({action:"",isOpen:!1});case 15:t.next=18;break;case 17:(0,O.Am)("ERROR 404: Room not found",{theme:"colored",position:n?"top-center":"top-right",className:"opacity-toast text-white"});case 18:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),[e]),Je=(0,c.useCallback)((0,a.Z)((0,o.Z)().mark((function t(){var n,i;return(0,o.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if("public"===Y.id){t.next=5;break}return n=(0,k.JU)(R.db,"rooms",Y.id),i=te.filter((function(t){return t.uid!==e.uid})),t.next=5,(0,k.r7)(n,{members:i});case 5:V({id:"public",name:"Public"}),de({action:"",isOpen:!1});case 7:case"end":return t.stop()}}),t)}))),[te]),Ae=function(){var t=(0,a.Z)((0,o.Z)().mark((function t(n,i){var s,r,c,l,d;return(0,o.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(s=[],!(Ze.length>0)){t.next=5;break}!function(){for(var t=O.Am.loading("Uploading image...",{theme:"colored",position:"top-right",className:"opacity-toast text-white"}),r=function(r){Ze[r].file.type;var c=(0,Z.iH)(Le,"images/"+Ze[r].file.name),l=(0,Z.B0)(c,Ze[r].file);l.on("state_changed",(function(e){var t=e.bytesTransferred/e.totalBytes*100;switch(console.log("Upload is "+t+"% done"),e.state){case"paused":console.log("Upload is paused");break;case"running":console.log("Upload is running")}}),(function(e){switch(e.code){case"storage/unauthorized":console.log("User doesnt have permission to access the object");break;case"storage/canceled":console.log("User canceled the upload");break;case"storage/unknown":console.log("Unknown error occurred")}}),(0,a.Z)((0,o.Z)().mark((function r(){return(0,o.Z)().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,(0,Z.Jt)(l.snapshot.ref).then(function(){var r=(0,a.Z)((0,o.Z)().mark((function a(r){var c,l,d,m;return(0,o.Z)().wrap((function(o){for(;;)switch(o.prev=o.next){case 0:if(console.log("File available at",r),s.push(r),s.length!==Ze.length){o.next=15;break}return console.log("all uploads done"),console.log(s),c=n.msg,l=null===c||void 0===c?void 0:c.trim(),d="public"===Y.id?(0,k.hJ)(R.db,"messages"):(0,k.hJ)(R.db,"rooms",Y.id,"messages"),m={uid:e.uid,displayName:e.displayName,photoURL:e.photoURL,message:l||"",imageURL:s,createdAt:k.EK.now()},o.next=11,(0,k.ET)(d,m);case 11:o.sent,i.resetForm(),Re([]),O.Am.update(t,{render:"Images Uploaded successfully",type:"default",className:"opacity-toast text-white",autoClose:2e3,isLoading:!1});case 15:case"end":return o.stop()}}),a)})));return function(e){return r.apply(this,arguments)}}());case 2:case"end":return r.stop()}}),r)}))))},c=0;c<Ze.length;c++)r(c)}(),t.next=15;break;case 5:if(r=n.msg,!((c=r.trim()).length>0)){t.next=13;break}return l="public"===Y.id?(0,k.hJ)(R.db,"messages"):(0,k.hJ)(R.db,"rooms",Y.id,"messages"),d={uid:e.uid,displayName:e.displayName,photoURL:e.photoURL,message:c,imageURL:s,createdAt:k.EK.now()},t.next=12,(0,k.ET)(l,d);case 12:t.sent;case 13:i.resetForm(),Re([]);case 15:case"end":return t.stop()}}),t)})));return function(e,n){return t.apply(this,arguments)}}(),He=(0,c.useCallback)(function(){var e=(0,a.Z)((0,o.Z)().mark((function e(t){return(0,o.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("public"!==Y.id){e.next=6;break}return e.next=3,(0,k.oe)((0,k.JU)(R.db,"messages",t));case 3:e.sent,e.next=9;break;case 6:return e.next=8,(0,k.oe)((0,k.JU)(R.db,"rooms",Y.id,"messages",t));case 8:e.sent;case 9:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),[Y]);return(0,S.jsxs)("div",{className:"d-flex justify-content-center chatroom-wrapper px-sm-4 pt-sm-3 pb-sm-5",children:[(0,S.jsx)("div",{className:"".concat(n?"d-none":""," start-0 h-100 d-flex align-items-start justify-content-start bg-room overflow-hidden"),style:{maxWidth:"12.5rem"},children:(0,S.jsxs)("div",{className:"p-0 d-flex flex-column h-100 justify-content-start position-relative",children:[(0,S.jsxs)("div",{className:"d-flex align-items-center",style:{minHeight:J},children:[(0,S.jsx)("div",{onClick:function(){de({action:"add",isOpen:!0})},className:"".concat(K?"":"d-none"," btn ms-1 bg-dark mt-1 pointer hover-opacity p-0 d-flex justify-content-center align-items-center"),style:{borderRadius:"50%",width:30,height:30,zIndex:20},children:(0,S.jsx)(f.Z,{width:A,height:A,fill:T})}),(0,S.jsx)("div",{onClick:function(){de({action:"join",isOpen:!0})},className:"".concat(K?"":"d-none"," btn ms-1 bg-dark mt-1 pointer hover-opacity p-0 d-flex justify-content-center align-items-center"),style:{borderRadius:"50%",width:30,height:30,zIndex:20},children:(0,S.jsx)(x.Z,{width:A,height:A,fill:T})})]}),(0,S.jsx)("div",{className:"transition me-1 overflow-auto border-bottom-chat",style:{width:"12rem",fontSize:"0.75rem",height:"calc(50% - 3.5rem)",left:"0px",zIndex:10},children:[{name:"public",id:"public"}].concat((0,i.Z)(se)).map((function(e,t){return(0,S.jsxs)("div",{className:"mb-1 text-white p-0 text-start w-100",children:[(0,S.jsxs)("div",{onClick:function(){Y.id!==e.id&&V({id:e.id,name:e.name}),n&&Q(!1)},className:"px-2 bg-chat pointer d-flex w-100 justify-content-between align-items-center",children:[(0,S.jsx)("div",{className:"col",children:e.name}),(0,S.jsx)("div",{className:"col-2 py-2 d-flex justify-content-center",children:(0,S.jsx)(g.Z,{width:20,height:20,fill:T})})]}),"public"!==e.id&&(0,S.jsxs)("div",{className:"px-2 d-flex align-items-center py-2",children:[(0,S.jsx)("div",{className:"text-break col",children:e.id}),(0,S.jsx)("div",{onClick:function(){navigator.clipboard.writeText(e.id),(0,O.Am)("Room ID Copied to clipboard",{theme:"colored",position:"top-right",className:"opacity-toast text-white"})},className:"col-2 d-flex justify-content-center pointer",children:(0,S.jsx)(b.Z,{width:A,height:A,fill:T})})]})]},t)}))}),(0,S.jsxs)("div",{className:"text-white",style:{flexGrow:1},children:[(0,S.jsxs)("div",{className:"my-2 ms-2 d-flex align-items-center justify-content-between",style:{fontSize:"0.75rem"},children:["Member :",(0,S.jsx)("div",{children:(0,S.jsx)("div",{onClick:function(){de({action:"leave",isOpen:!0})},className:"".concat("public"===Y.id?"d-none":""," btn me-1 bg-dark pointer hover-opacity p-0 d-flex justify-content-center align-items-center"),style:{borderRadius:"50%",width:30,height:30,zIndex:20},children:(0,S.jsx)(v.Z,{width:A,height:A,fill:T})})})]}),(0,S.jsx)("div",{children:te.map((function(e,t){return(0,S.jsx)("img",{style:{width:"1.5rem",height:"1.5rem",borderRadius:"50%",marginLeft:"0.5rem"},src:e.photoURL,alt:"avatar"},t)}))})]})]})}),(0,S.jsxs)("div",{className:"chatroom shadow d-flex flex-column position-relative ".concat(n?"":"overflow-hidden"),children:[(0,S.jsx)("div",{onClick:function(){Q(!K)},className:"".concat(K&&n?"":"d-none"," backdrop position-absolute w-100 h-100"),style:{zIndex:1010}}),(0,S.jsx)("div",{className:"".concat(n?"position-fixed":"d-none"," start-0 h-100 d-flex align-items-start justify-content-start"),style:{zIndex:1020},children:(0,S.jsxs)("div",{className:"p-0 d-flex ".concat(n?"flex-column align-items-center":"d-flex align-items-start"," h-100 justify-content-start position-relative"),children:[(0,S.jsxs)("div",{className:"d-flex align-items-center",children:[(0,S.jsx)("div",{onClick:function(){Q(!K)},style:{zIndex:20,minHeight:"30px"},className:"rounded-pill pointer badge p-2 mt-1 ms-1 shadow ".concat(K?"d-none":"bg-dark"),children:Y.name}),(0,S.jsx)("div",{onClick:function(){de({action:"add",isOpen:!0})},className:"".concat(K?"":"d-none"," btn ms-1 bg-chat mt-1 pointer hover-opacity p-0 d-flex justify-content-center align-items-center"),style:{borderRadius:"50%",width:30,height:30,zIndex:20},children:(0,S.jsx)(f.Z,{width:A,height:A,fill:T})}),(0,S.jsx)("div",{onClick:function(){de({action:"join",isOpen:!0})},className:"".concat(K?"":"d-none"," btn ms-1 bg-chat mt-1 pointer hover-opacity p-0 d-flex justify-content-center align-items-center"),style:{borderRadius:"50%",width:30,height:30,zIndex:20},children:(0,S.jsx)(x.Z,{width:A,height:A,fill:T})})]}),(0,S.jsxs)("div",{className:"transition pe-1 shadow bg-primary position-absolute h-100",style:{transform:K?"translateX(0)":"translateX(-12rem)",width:"12rem",fontSize:"0.75rem",paddingTop:"4rem",left:"0px",zIndex:10},children:[(0,S.jsx)("div",{className:"h-50 border-bottom-chat overflow-auto",children:[{name:"public",id:"public"}].concat((0,i.Z)(se)).map((function(e,t){return(0,S.jsxs)("div",{className:"mb-1 text-white p-0 text-start w-100",children:[(0,S.jsxs)("div",{onClick:function(){Y.id!==e.id&&V({id:e.id,name:e.name}),n&&Q(!1)},className:"px-2 bg-chat pointer d-flex w-100 justify-content-between align-items-center",children:[(0,S.jsx)("div",{className:"col",children:e.name}),(0,S.jsx)("div",{className:"col-2 py-2 d-flex justify-content-center",children:(0,S.jsx)(g.Z,{width:20,height:20,fill:T})})]}),"public"!==e.id&&(0,S.jsxs)("div",{className:"px-2 d-flex align-items-center py-2",children:[(0,S.jsx)("div",{className:"text-break col",children:e.id}),(0,S.jsx)("div",{onClick:function(){navigator.clipboard.writeText(e.id),(0,O.Am)("Room ID Copied to clipboard",{theme:"colored",position:"top-center",className:"opacity-toast text-white"})},className:"col-2 d-flex justify-content-center pointer",children:(0,S.jsx)(b.Z,{width:A,height:A,fill:T})})]})]},t)}))}),(0,S.jsxs)("div",{className:"text-white",style:{flexGrow:1},children:[(0,S.jsxs)("div",{className:"my-2 ms-2 d-flex justify-content-between align-items-center",children:["Member :",(0,S.jsx)("div",{children:(0,S.jsx)("div",{onClick:function(){de({action:"leave",isOpen:!0})},className:"".concat("public"===Y.id?"d-none":""," btn me-1 bg-chat pointer hover-opacity p-0 d-flex justify-content-center align-items-center"),style:{borderRadius:"50%",width:30,height:30,zIndex:20},children:(0,S.jsx)(v.Z,{width:A,height:A,fill:T})})})]}),(0,S.jsx)("div",{children:te.map((function(e,t){return(0,S.jsx)("img",{style:{width:"1.5rem",height:"1.5rem",borderRadius:"50%",marginLeft:"0.5rem"},src:e.photoURL,alt:"avatar"},t)}))})]})]})]})}),(0,S.jsx)("div",{ref:Ue,className:"room-title d-none d-sm-flex justify-content-center align-items-center border-bottom text-center shadow",style:{height:J,fontSize:"1rem"},children:Y.name}),(0,S.jsx)("div",{onClick:function(){n?window.scrollTo({top:document.body.scrollHeight,behavior:"smooth"}):Ie.current.scrollTo({top:Ie.current.scrollHeight,behavior:"smooth"})},style:{borderRadius:"50%",opacity:P?1:0,transform:P?"translateY(0)":"translateX(100%)"},className:"".concat(n?"position-fixed":"position-absolute"," scroll-to pointer bg-dark transition mb-5 mb-sm-0 shadow"),children:(0,S.jsx)(L.JO,{svg:!0,name:"arrow-down",size:20,color:"white"})}),(0,S.jsx)("div",{ref:Ie,onScroll:Se,className:"room-content hideScroll pt-5 pt-sm-1",style:{paddingBottom:he},children:ze.map((function(t,i){return(0,S.jsx)(L.z5,{parentLength:ze.length,itemIndex:i,name:t.displayName,message:t.message,self:(null===e||void 0===e?void 0:e.uid)===(null===t||void 0===t?void 0:t.uid),avatar:t.photoURL,imageURL:t.imageURL,uid:t.uid,createdAt:t.createdAt,onPress:function(e){M({action:e,id:t.id}),de({action:"delete",isOpen:!0})},scrollToBottom:function(){n?window.scrollTo({top:document.body.scrollHeight,behavior:"smooth"}):Ie.current.scrollTo({top:Ie.current.scrollHeight,behavior:"smooth"})}},i)}))}),(0,S.jsx)("div",{className:"border-top pt-3 pb-5 pb-sm-3 input-fixed",style:{zIndex:30},children:(0,S.jsx)(y.J9,{initialValues:{msg:""},validationSchema:E,onSubmit:Ae,children:function(e){e.values;return(0,S.jsxs)(y.l0,{className:"d-flex w-100 px-4",onChange:function(){},children:[(0,S.jsx)("div",{className:"col",children:(0,S.jsx)(L.UP,{onInputChange:function(e){""!==e&&e.length>0&&function(e){var t=e>5?5:e;ge(t),pe("".concat(n?1.5*t+5.5:1.5*t+6.5,"rem")),setTimeout((function(){n?window.scrollTo({top:document.body.scrollHeight,behavior:"smooth"}):Ie.current.scrollTo({top:Ie.current.scrollHeight,behavior:"smooth"})}),50)}(e.split("\n").length)},style:{backgroundColor:"rgba(54, 57, 63, 0.8)",border:"none",caretColor:"white",color:"white",resize:"none"},name:"msg",placeholder:"Input something...",type:"textarea",showError:!1,rows:be})}),(0,S.jsxs)("div",{className:"d-flex align-items-center",children:[(0,S.jsx)(h(),{multiple:!0,value:Ze,onChange:Ce,maxNumber:void 0,onError:function(e){O.Am.error(null!==e&&void 0!==e&&e.maxFileSize?"image must be smaller than 2MB":"Unsupported format",{theme:"colored",position:n?"top-center":"top-right",className:"opacity-toast text-white"})},maxFileSize:2097152,children:function(e){var t,i=e.imageList,o=e.onImageUpload,s=(e.onImageRemoveAll,e.onImageUpdate,e.onImageRemove);e.errors;return(0,S.jsxs)("div",{className:"".concat(n?"":"position-relative"," upload__image-wrapper d-flex"),children:[(0,S.jsx)("div",{className:"".concat(n?"":"me-4"," d-flex overflow-auto end-0 position-fixed"),style:{bottom:he,maxWidth:n?"100vw":null===Ie||void 0===Ie||null===(t=Ie.current)||void 0===t?void 0:t.offsetWidth},children:i.map((function(e,t){return(0,S.jsxs)("div",{className:"image-item d-flex",children:[(0,S.jsx)("img",{src:e.dataURL,alt:"",height:"100",className:"me-2"}),(0,S.jsx)("button",{className:"btn p-0 me-2 align-self-start",style:{borderRadius:"50%",border:"none"},onClick:function(){return s(t)},children:(0,S.jsx)(j.Z,{width:15,height:15,fill:T})})]},t)}))}),(0,S.jsx)("button",{type:"button",className:"btn p-0 me-2",style:{borderRadius:"50%",border:"none"},onClick:o,children:(0,S.jsx)(w.Z,{width:30,height:30,fill:T})})]})}}),(0,S.jsx)("button",{className:"btn p-0",style:{borderRadius:"50%",border:"none"},type:"submit",children:(0,S.jsx)(p.Z,{width:30,height:30,fill:T})})]}),(0,S.jsx)("div",{className:"mt-4 text-center"})]})}})})]}),(0,S.jsx)(z.Z,{open:le.isOpen,title:"delete"===le.action?"Confirm delete?":"add"===le.action?"Add new room":"join"===le.action?"Join room":"leave"===le.action?"Leave room":"",withInput:["add","join"].includes(le.action),message:"delete"===le.action?"Deleted content cannot be recovered.":"add"===le.action?"Please input room name.":"join"===le.action?"Please input Room ID to join a room.":"leave"===le.action?"Confirm to leave this room?":"",onCancel:function(){"delete"===le.action&&M(void 0),de({action:"",isOpen:!1})},onConfirm:function(e){switch(le.action){case"delete":D&&"DELETE"===D.action&&He(D.id),M(void 0),de({action:"",isOpen:!1});break;case"add":Ee(e);break;case"join":Te(e);break;case"leave":Je()}}})]})}}}]);
//# sourceMappingURL=316.28cf9209.chunk.js.map