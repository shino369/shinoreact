"use strict";(self.webpackChunkshinoreact=self.webpackChunkshinoreact||[]).push([[316],{54316:function(e,t,o){o.r(t),o.d(t,{ChatPage:function(){return y}});var n=o(74165),r=o(15861),s=o(70885),i=o(72791),a=o(59434),c=o(39478),l=o(9062),d=o(18643),u=o(80922),m=o(80456),h=o(55705),p=o(81724),f=o(763),v=o.n(f),b=o(24805),g=o(57375),x=o(80184),w=p.Ry().shape({msg:p.Z_().required("required")}),y=function(){var e=(0,b.useMediaQuery)({query:"(max-width: 576px)"}),t=(0,a.I0)(),o=(0,a.v9)((function(e){return e.auth})).user,p=(0,i.useState)([]),f=(0,s.Z)(p,2),y=(f[0],f[1],(0,i.useState)(!1)),j=(0,s.Z)(y,2),N=j[0],Z=j[1],k=(0,i.useState)(!1),C=(0,s.Z)(k,2),E=C[0],S=C[1],H=(0,i.useState)(),T=(0,s.Z)(H,2),R=T[0],J=T[1];(0,i.useEffect)((function(){t((0,c.wC)("chat"))}),[t]);var L=(0,l.IO)((0,l.hJ)(d.db,"messages"),(0,l.Xo)("createdAt"),(0,l.b9)(100)),U=(0,u.sQ)(L),z=(0,i.useRef)(null),A=(0,i.useState)(e?"7rem":"1rem"),I=(0,s.Z)(A,2),q=I[0],D=I[1],P=(0,i.useState)(1),O=(0,s.Z)(P,2),Q=O[0],X=O[1];(0,i.useEffect)((function(){e?window.scrollTo({top:document.body.scrollHeight,behavior:"smooth"}):z.current.scrollTo({top:z.current.scrollHeight,behavior:"smooth"})}),[U]),(0,i.useEffect)((function(){var t=v().debounce((function(t){if(e){var o=window.scrollY,n=document.body.scrollHeight,r=window.innerHeight;Z(o+r+200<n)}}),100);return window.addEventListener("scroll",t),function(){window.removeEventListener("scroll",t)}}),[]);var Y=v().debounce((function(t){if(!e){var o=t.target.scrollTop,n=t.target.scrollHeight,r=t.target.clientHeight;Z(o+r+200<n)}}),100),B=function(){var e=(0,r.Z)((0,n.Z)().mark((function e(t,r){var s,i,a;return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(s=t.msg,!((i=s.trim()).length>0)){e.next=8;break}return(0,l.hJ)(d.db,"messages"),a={uid:o.uid,displayName:o.displayName,photoURL:o.photoURL,message:i,createdAt:l.EK.now()},e.next=7,(0,l.ET)((0,l.hJ)(d.db,"messages"),a);case 7:e.sent;case 8:r.resetForm();case 9:case"end":return e.stop()}}),e)})));return function(t,o){return e.apply(this,arguments)}}(),F=(0,i.useCallback)(function(){var e=(0,r.Z)((0,n.Z)().mark((function e(t){return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,l.oe)((0,l.JU)(d.db,"messages",t));case 2:e.sent;case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),[]);return(0,x.jsxs)("div",{className:"d-flex justify-content-center chatroom-wrapper px-sm-4 pt-sm-3 pb-sm-5",children:[(0,x.jsxs)("div",{className:"chatroom shadow d-flex flex-column position-relative",children:[(0,x.jsx)("div",{className:"room-title d-none d-sm-block border-bottom text-center py-3 shadow",children:"Realtime Chat Room"}),(0,x.jsx)("div",{onClick:function(){e?window.scrollTo({top:document.body.scrollHeight,behavior:"smooth"}):z.current.scrollTo({top:z.current.scrollHeight,behavior:"smooth"})},style:{borderRadius:"50%",opacity:N?1:0,transform:N?"translateY(0)":"translateX(100%)"},className:"".concat(e?"position-fixed":"position-absolute"," scroll-to pointer bg-dark transition mb-5 mb-sm-0 shadow"),children:(0,x.jsx)(m.JO,{svg:!0,name:"arrow-down",size:30,color:"white"})}),(0,x.jsx)("div",{ref:z,onScroll:Y,className:"room-content hideScroll pt-5 pt-sm-1",style:{paddingBottom:q},children:U.map((function(e,t){return(0,x.jsx)(m.z5,{name:e.displayName,message:e.message,self:(null===o||void 0===o?void 0:o.uid)===(null===e||void 0===e?void 0:e.uid),avatar:e.photoURL,uid:e.uid,createdAt:e.createdAt,onPress:function(t){J({action:t,id:e.id}),S(!0)}},t)}))}),(0,x.jsx)("div",{className:"border-top pt-3 pb-5 pb-sm-3 input-fixed",style:{zIndex:30},children:(0,x.jsx)(h.J9,{initialValues:{msg:""},validationSchema:w,onSubmit:B,children:function(t){var o=t.values;return(0,x.jsxs)(h.l0,{className:"d-flex w-100 px-4",onChange:function(){var t;!function(t){var o=t>5?5:t;X(o),e&&D("".concat(1.5*o+5.5,"rem")),setTimeout((function(){e?window.scrollTo({top:document.body.scrollHeight,behavior:"smooth"}):z.current.scrollTo({top:z.current.scrollHeight,behavior:"smooth"})}),50)}(null===(t=o.msg)||void 0===t?void 0:t.split("\n").length)},children:[(0,x.jsx)("div",{className:"col",children:(0,x.jsx)(m.UP,{style:{backgroundColor:"rgba(54, 57, 63, 0.8)",border:"none",caretColor:"white",color:"white",resize:"none"},name:"msg",placeholder:"Input something...",type:"textarea",showError:!1,rows:Q})}),(0,x.jsx)("div",{className:"d-flex align-items-center",children:(0,x.jsx)("button",{className:"btn btn-primary btn-block",type:"submit",children:"SEND"})}),(0,x.jsx)("div",{className:"mt-4 text-center"})]})}})})]}),(0,x.jsx)(g.Z,{open:E,title:"Confirm delete?",message:"Deleted content cannot be recovered.",onCancel:function(){J(void 0),S(!1)},onConfirm:function(){R&&"DELETE"===R.action&&F(R.id),J(void 0),S(!1)}})]})}}}]);
//# sourceMappingURL=316.f8b30a2d.chunk.js.map