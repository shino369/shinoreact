{"version":3,"file":"static/js/316.b498450c.chunk.js","mappings":"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","sources":["app/pages/chat/index.tsx"],"sourcesContent":["import { useCallback, useEffect, useRef, useState } from \"react\";\nimport { useDispatch, useSelector } from \"react-redux\";\nimport { RootState } from \"store\";\nimport { Link } from \"react-router-dom\";\nimport { setActiveRoute } from \"store/activeRoute\";\nimport { useMediaQuery } from \"react-responsive\";\n\n// react suite\nimport ReadyRoundIcon from \"@rsuite/icons/ReadyRound\";\nimport PeoplesIcon from \"@rsuite/icons/Peoples\";\nimport PlusRoundIcon from \"@rsuite/icons/PlusRound\";\nimport SearchIcon from \"@rsuite/icons/Search\";\nimport CopyIcon from \"@rsuite/icons/Copy\";\nimport ArrowRightLineIcon from \"@rsuite/icons/ArrowRightLine\";\n\n// form\nimport { Input, Table } from \"reactstrap\";\nimport { Form, Formik, FormikHelpers } from \"formik\";\nimport * as Yup from \"yup\";\n\n// firebase\nimport {\n  addDoc,\n  collection,\n  doc,\n  getDoc,\n  getDocs,\n  updateDoc,\n  deleteDoc,\n  limit,\n  onSnapshot,\n  orderBy,\n  query,\n  Timestamp,\n  where,\n} from \"firebase/firestore\";\nimport { db } from \"app/hooks/firebase\";\n\n// library\nimport moment from \"moment\";\nimport _ from \"lodash\";\n\n// hook\nimport { useFirestoreQuery } from \"app/hooks/commonHook\";\n\n// style\nimport \"./index.scss\";\n\n// component\nimport { ChatItem, Icon, InputField } from \"app/components\";\nimport ConfimrDialog from \"app/components/dialog/confirmDialog\";\nimport { toast } from \"react-toastify\";\n\nconst Schema = Yup.object().shape({\n  msg: Yup.string().required(\"required\"),\n});\n\ntype FormItem = {\n  msg: string;\n};\n\nconst ICON_COLOR = \"#fff\";\nconst CHAT_TOP_HEIGHT = \"3.5rem\";\nconst ICON_SIZE = 15;\n\ninterface PendingAction {\n  action: string;\n  id: string;\n}\n\nexport const ChatPage = () => {\n  const { user } = useSelector((rootState: RootState) => rootState.auth);\n  const dispatch = useDispatch();\n  const isMobile = useMediaQuery({ query: `(max-width: 576px)` });\n  const [newMessage, setNewMessage] = useState<any[]>([]);\n  const [visible, setVisible] = useState<boolean>(false);\n  const [isOpen, setIsOpen] = useState<boolean>(false);\n  const [pendingAction, setPendingAction] = useState<PendingAction>();\n  const [showRooms, setShowRooms] = useState<boolean>(!isMobile);\n  const [activeRoom, setActiveRoom] = useState<string>(\"public\");\n  const [rooms, setRooms] = useState<any[]>([]);\n  const [newRoomDialog, setNewRoomDialog] = useState<boolean>(false);\n  const [joinRoomDialog, setJoinRoomDialog] = useState<boolean>(false);\n\n  const [paddingBottom, setPaddingBottom] = useState<string>(\n    isMobile ? \"7rem\" : \"1rem\"\n  );\n  const [rows, setRows] = useState<number>(1);\n\n  const [querying, setQuerying] = useState<any>(\n    query(collection(db, \"messages\"), orderBy(\"createdAt\"), limit(100))\n  );\n  const headerRef = useRef<any>(null);\n  const scrollRef = useRef<any>(null);\n\n  // change query when activeRoom change\n  useEffect(() => {\n    if (activeRoom === \"public\") {\n      setQuerying(\n        query(collection(db, \"messages\"), orderBy(\"createdAt\"), limit(100))\n      );\n    } else {\n      setQuerying(\n        query(\n          collection(db, \"rooms\", activeRoom, \"messages\"),\n          orderBy(\"createdAt\"),\n          limit(100)\n        )\n      );\n    }\n  }, [activeRoom]);\n\n  const messages = useFirestoreQuery(querying);\n\n  /*\n  fake data to prevent heavy read of firestore in testing\n  [\n    {\n      displayName: \"test\",\n      id: \"gkjshgkjsnh\",\n      photoURL: \"\",\n      createdAt: \"\",\n      uid: \"safsgsakfasj\",\n      message: \"safakgalgalj\",\n    },\n  ]; \n  */\n\n  useEffect(() => {\n    dispatch(setActiveRoute(\"chat\"));\n  }, [dispatch]);\n\n  // scroll to bottom when new message come\n  useEffect(() => {\n    isMobile\n      ? window.scrollTo({\n          top: document.body.scrollHeight,\n          behavior: \"smooth\",\n        })\n      : scrollRef.current.scrollTo({\n          top: scrollRef.current.scrollHeight,\n          behavior: \"smooth\",\n        });\n  }, [messages]);\n\n  // get rooms list\n  const getTotalRooms = useCallback(async () => {\n    const q = query(\n      collection(db, \"rooms\"),\n      where(\"members\", \"array-contains\", user!.uid)\n    );\n    const querySnapshot = await getDocs(q);\n    let roomTotal: any = [];\n    querySnapshot.forEach((doc) => {\n      roomTotal.push({ id: doc.id, ...doc.data() });\n    });\n    setRooms(roomTotal);\n  }, [user]);\n\n  // refresh list when activeRoom change\n  useEffect(() => {\n    getTotalRooms();\n  }, [activeRoom, getTotalRooms]);\n\n  // scroll to bottom button effect (body in mobile)\n  useEffect(() => {\n    const windowScroll = _.debounce((e) => {\n      if (isMobile) {\n        const scrollTop = window.scrollY;\n        const scrollHeight = document.body.scrollHeight;\n        const clientHeight = window.innerHeight;\n        if (scrollTop + clientHeight + 200 < scrollHeight) {\n          setVisible(true);\n        } else {\n          setVisible(false);\n        }\n      }\n    }, 100);\n\n    window.addEventListener(\"scroll\", windowScroll);\n    return () => {\n      window.removeEventListener(\"scroll\", windowScroll);\n    };\n  }, []);\n\n  // scroll to bottom button effect (container in breakpoint > sm)\n  const handleScroll = _.debounce((e) => {\n    if (!isMobile) {\n      const scrollTop = e.target.scrollTop;\n      const scrollHeight = e.target.scrollHeight;\n      const clientHeight = e.target.clientHeight;\n      // console.log(scrollTop + clientHeight, scrollHeight);\n      if (scrollTop + clientHeight + 200 < scrollHeight) {\n        setVisible(true);\n      } else {\n        setVisible(false);\n      }\n    }\n  }, 100);\n\n  // add new room\n  const handleAddNewRoom = useCallback(\n    async (room: any) => {\n      const newRoom = await addDoc(collection(db, \"rooms\"), {\n        name: room,\n        members: [user!.uid],\n      });\n      // add subcollection messages to newRoom\n      await addDoc(collection(db, \"rooms\", newRoom.id, \"messages\"), {\n        uid: user!.uid,\n        displayName: user!.displayName,\n        photoURL: user!.photoURL,\n        message: \"Welcome to the room\",\n        createdAt: Timestamp.now(),\n      });\n\n      setNewRoomDialog(false);\n      setActiveRoom(newRoom.id);\n    },\n    [user]\n  );\n\n  const handleJoinRoom = useCallback(\n    async (room: any) => {\n      const roomRef = doc(db, \"rooms\", room);\n      const roomData = await getDoc(roomRef);\n      if (roomData.exists()) {\n        const members = roomData.data().members;\n        if (members.includes(user!.uid)) {\n          setActiveRoom(room);\n          setJoinRoomDialog(false);\n        } else {\n          // add user into members\n          await updateDoc(roomRef, {\n            members: [...members, user!.uid],\n          });\n          setActiveRoom(room);\n        }\n      } else {\n        toast.error(\"Room not found\");\n      }\n    },\n    [user]\n  );\n\n  // handle form submit new message\n  const onSubmit = async (\n    values: FormItem,\n    actions: FormikHelpers<FormItem>\n  ) => {\n    const { msg } = values;\n    const trimmed = msg.trim();\n    if (trimmed.length > 0) {\n      const _q =\n        activeRoom === \"public\"\n          ? collection(db, \"messages\")\n          : collection(db, \"rooms\", activeRoom, \"messages\");\n\n      const message = {\n        uid: user!.uid,\n        displayName: user!.displayName,\n        photoURL: user!.photoURL,\n        message: trimmed,\n        createdAt: Timestamp.now(),\n      };\n      const docRef = await addDoc(_q, message);\n    }\n    actions.resetForm();\n    // console.log(\"values\", values);\n    // submit to firebase\n  };\n\n  // auto grow textarea\n  const handleRows = (rows: number) => {\n    const _rows = rows > 5 ? 5 : rows;\n    setRows(_rows);\n    if (isMobile) {\n      setPaddingBottom(`${_rows * 1.5 + 5.5}rem`);\n    }\n    setTimeout(() => {\n      isMobile\n        ? window.scrollTo({\n            top: document.body.scrollHeight,\n            behavior: \"smooth\",\n          })\n        : scrollRef.current.scrollTo({\n            top: scrollRef.current.scrollHeight,\n            behavior: \"smooth\",\n          });\n    }, 50);\n  };\n\n  // delete message\n  const deleteChatItem = useCallback(\n    async (id: string) => {\n      if (activeRoom === \"public\") {\n        const res = await deleteDoc(doc(db, \"messages\", id));\n      } else {\n        const res = await deleteDoc(\n          doc(db, \"rooms\", activeRoom, \"messages\", id)\n        );\n      }\n\n      // console.log(res);\n    },\n    [activeRoom]\n  );\n\n  // after confirm dialog\n  const handleOptions = () => {\n    if (pendingAction && pendingAction.action === \"DELETE\") {\n      deleteChatItem(pendingAction.id);\n    }\n    setPendingAction(undefined);\n    setIsOpen(false);\n  };\n\n  return (\n    <div className=\"d-flex justify-content-center chatroom-wrapper px-sm-4 pt-sm-3 pb-sm-5\">\n      <div\n        className={`${\n          isMobile ? \"d-none\" : \"\"\n        } start-0 h-100 d-flex align-items-start justify-content-start bg-room overflow-hidden`}\n      >\n        <div\n          className={`p-0 d-flex flex-column h-100 justify-content-start position-relative`}\n        >\n          <div\n            className=\"d-flex align-items-center\"\n            style={{\n              minHeight: CHAT_TOP_HEIGHT,\n            }}\n          >\n            <div\n              onClick={() => {\n                setShowRooms(!showRooms);\n              }}\n              className=\"d-sm-none btn ms-1 mt-1 bg-dark pointer hover-opacity p-0 d-flex justify-content-center align-items-center\"\n              style={{\n                borderRadius: \"50%\",\n                width: 30,\n                height: 30,\n                zIndex: 20,\n              }}\n            >\n              <PeoplesIcon\n                width={ICON_SIZE}\n                height={ICON_SIZE}\n                fill={ICON_COLOR}\n              />\n            </div>\n            <div\n              onClick={() => {\n                setNewRoomDialog(true);\n              }}\n              className={`${\n                !showRooms ? \"d-none\" : \"\"\n              } btn ms-1 bg-dark mt-1 pointer hover-opacity p-0 d-flex justify-content-center align-items-center`}\n              style={{\n                borderRadius: \"50%\",\n                width: 30,\n                height: 30,\n                zIndex: 20,\n              }}\n            >\n              <PlusRoundIcon\n                width={ICON_SIZE}\n                height={ICON_SIZE}\n                fill={ICON_COLOR}\n              />\n            </div>\n            <div\n              onClick={() => {\n                setJoinRoomDialog(true);\n              }}\n              className={`${\n                !showRooms ? \"d-none\" : \"\"\n              } btn ms-1 bg-dark mt-1 pointer hover-opacity p-0 d-flex justify-content-center align-items-center`}\n              style={{\n                borderRadius: \"50%\",\n                width: 30,\n                height: 30,\n                zIndex: 20,\n              }}\n            >\n              <SearchIcon\n                width={ICON_SIZE}\n                height={ICON_SIZE}\n                fill={ICON_COLOR}\n              />\n            </div>\n          </div>\n\n          <div\n            className=\"transition me-1 overflow-scroll\"\n            style={{\n              // transform: showRooms ? \"translateX(0)\" : \"translateX(-8rem)\",\n              width: \"8rem\",\n              fontSize: \"0.75rem\",\n\n              left: \"0px\",\n              zIndex: 10,\n            }}\n          >\n            {[{ name: \"public\", id: \"public\" }, ...rooms].map((item, index) => (\n              <div key={index} className=\"mb-1 text-white p-0 text-start w-100\">\n                <div\n                  onClick={() => {\n                    if (activeRoom !== item.id) {\n                      setActiveRoom(item.id);\n                    }\n                    isMobile && setShowRooms(false);\n                  }}\n                  className=\"px-2 bg-chat pointer d-flex w-100 justify-content-between align-items-center\"\n                >\n                  <div className=\"col\">{item.name}</div>\n                  <div className=\"col-2 py-2\">\n                    <ArrowRightLineIcon\n                      width={20}\n                      height={20}\n                      fill={ICON_COLOR}\n                    />\n                  </div>\n                </div>\n                {item.id !== \"public\" && (\n                  <div className=\"px-2 d-flex align-items-center\">\n                    <div className=\"text-break col\">{item.id}</div>\n                    <div\n                      onClick={() => {\n                        // copy text to clipboard\n                        navigator.clipboard.writeText(item.id);\n                      }}\n                      className=\"col-2 d-flex justify-content-end pointer\"\n                    >\n                      <CopyIcon\n                        width={ICON_SIZE}\n                        height={ICON_SIZE}\n                        fill={ICON_COLOR}\n                      />\n                    </div>\n                  </div>\n                )}\n              </div>\n            ))}\n          </div>\n        </div>\n      </div>\n      <div\n        className={`chatroom shadow d-flex flex-column position-relative ${\n          isMobile ? \"\" : \"overflow-hidden\"\n        }`}\n      >\n        <div\n          onClick={() => {\n            setShowRooms(!showRooms);\n          }}\n          className={`${\n            showRooms && isMobile ? \"\" : \"d-none\"\n          } backdrop position-absolute w-100 h-100`}\n          style={{ zIndex: 1010 }}\n        />\n        <div\n          className={`${\n            isMobile ? \"position-fixed\" : \"d-none\"\n          } start-0 h-100 d-flex align-items-start justify-content-start`}\n          style={{ zIndex: 1020 }}\n        >\n          <div\n            className={`p-0 d-flex ${\n              isMobile\n                ? \"flex-column align-items-center\"\n                : \"d-flex align-items-start\"\n            } h-100 justify-content-start position-relative`}\n          >\n            <div className=\"d-flex align-items-center\">\n              <div\n                onClick={() => {\n                  setShowRooms(!showRooms);\n                }}\n                className=\"btn ms-1 mt-1 bg-dark pointer hover-opacity p-0 d-flex justify-content-center align-items-center\"\n                style={{\n                  borderRadius: \"50%\",\n                  width: 30,\n                  height: 30,\n                  zIndex: 20,\n                }}\n              >\n                <PeoplesIcon\n                  width={ICON_SIZE}\n                  height={ICON_SIZE}\n                  fill={ICON_COLOR}\n                />\n              </div>\n              <div\n                onClick={() => {\n                  setNewRoomDialog(true);\n                }}\n                className={`${\n                  !showRooms ? \"d-none\" : \"\"\n                } btn ms-1 bg-dark mt-1 pointer hover-opacity p-0 d-flex justify-content-center align-items-center`}\n                style={{\n                  borderRadius: \"50%\",\n                  width: 30,\n                  height: 30,\n                  zIndex: 20,\n                }}\n              >\n                <PlusRoundIcon\n                  width={ICON_SIZE}\n                  height={ICON_SIZE}\n                  fill={ICON_COLOR}\n                />\n              </div>\n              <div\n                onClick={() => {\n                  setJoinRoomDialog(true);\n                }}\n                className={`${\n                  !showRooms ? \"d-none\" : \"\"\n                } btn ms-1 bg-dark mt-1 pointer hover-opacity p-0 d-flex justify-content-center align-items-center`}\n                style={{\n                  borderRadius: \"50%\",\n                  width: 30,\n                  height: 30,\n                  zIndex: 20,\n                }}\n              >\n                <SearchIcon\n                  width={ICON_SIZE}\n                  height={ICON_SIZE}\n                  fill={ICON_COLOR}\n                />\n              </div>\n            </div>\n            <div\n              className=\"transition shadow pe-1 bg-primary position-absolute h-100\"\n              style={{\n                transform: showRooms ? \"translateX(0)\" : \"translateX(-8rem)\",\n                width: \"8rem\",\n                fontSize: \"0.75rem\",\n                paddingTop: \"4rem\",\n                left: \"0px\",\n                zIndex: 10,\n              }}\n            >\n              {[{ name: \"public\", id: \"public\" }, ...rooms].map(\n                (item, index) => (\n                  <div\n                    key={index}\n                    className=\"mb-1 text-white p-0 text-start w-100\"\n                  >\n                    <div\n                      onClick={() => {\n                        if (activeRoom !== item.id) {\n                          setActiveRoom(item.id);\n                        }\n                        isMobile && setShowRooms(false);\n                      }}\n                      className=\"px-2 bg-chat pointer d-flex w-100 justify-content-between align-items-center\"\n                    >\n                      <div className=\"col\">{item.name}</div>\n                      <div className=\"col-2 py-2\">\n                        <ArrowRightLineIcon\n                          width={20}\n                          height={20}\n                          fill={ICON_COLOR}\n                        />\n                      </div>\n                    </div>\n                    {item.id !== \"public\" && (\n                      <div className=\"px-2 d-flex align-items-center\">\n                        <div className=\"text-break col\">{item.id}</div>\n                        <div\n                          onClick={() => {\n                            // copy text to clipboard\n                            navigator.clipboard.writeText(item.id);\n                          }}\n                          className=\"col-2 d-flex justify-content-end pointer\"\n                        >\n                          <CopyIcon\n                            width={ICON_SIZE}\n                            height={ICON_SIZE}\n                            fill={ICON_COLOR}\n                          />\n                        </div>\n                      </div>\n                    )}\n                  </div>\n                )\n              )}\n            </div>\n          </div>\n        </div>\n        <div\n          ref={headerRef}\n          className=\"room-title d-none d-sm-flex justify-content-center align-items-center border-bottom text-center shadow\"\n          style={{\n            height: CHAT_TOP_HEIGHT,\n            fontSize: \"1rem\",\n          }}\n        >\n          Realtime Chat Room\n        </div>\n        <div\n          onClick={() => {\n            isMobile\n              ? window.scrollTo({\n                  top: document.body.scrollHeight,\n                  behavior: \"smooth\",\n                })\n              : scrollRef.current.scrollTo({\n                  top: scrollRef.current.scrollHeight,\n                  behavior: \"smooth\",\n                });\n          }}\n          style={{\n            borderRadius: \"50%\",\n            opacity: visible ? 1 : 0,\n            transform: visible ? \"translateY(0)\" : \"translateX(100%)\",\n          }}\n          className={`${\n            isMobile ? \"position-fixed\" : \"position-absolute\"\n          } scroll-to pointer bg-dark transition mb-5 mb-sm-0 shadow`}\n        >\n          <Icon svg name=\"arrow-down\" size={20} color={\"white\"} />\n        </div>\n        <div\n          ref={scrollRef}\n          onScroll={handleScroll}\n          className=\"room-content hideScroll pt-5 pt-sm-1\"\n          style={{\n            paddingBottom: paddingBottom,\n          }}\n        >\n          {messages.map((item, index) => (\n            <ChatItem\n              key={index}\n              name={item.displayName}\n              message={item.message}\n              self={user?.uid === item?.uid}\n              avatar={item.photoURL}\n              uid={item.uid}\n              createdAt={item.createdAt}\n              onPress={(action) => {\n                setPendingAction({ action: action, id: item.id });\n                setIsOpen(true);\n              }}\n            />\n          ))}\n        </div>\n        <div\n          className=\"border-top pt-3 pb-5 pb-sm-3 input-fixed\"\n          style={{ zIndex: 30 }}\n        >\n          <Formik\n            initialValues={{\n              msg: \"\",\n            }}\n            validationSchema={Schema}\n            onSubmit={onSubmit}\n          >\n            {({ values }) => (\n              <Form className=\"d-flex w-100 px-4\" onChange={() => {}}>\n                <div className=\"col\">\n                  <InputField\n                    onInputChange={(e: any) => {\n                      e !== \"\" &&\n                        e.length > 0 &&\n                        handleRows(e.split(\"\\n\").length);\n                    }}\n                    style={{\n                      backgroundColor: \"rgba(54, 57, 63, 0.8)\",\n                      border: \"none\",\n                      caretColor: \"white\",\n                      color: \"white\",\n                      resize: \"none\",\n                    }}\n                    name=\"msg\"\n                    placeholder=\"Input something...\"\n                    type=\"textarea\"\n                    showError={false}\n                    rows={rows}\n                  />\n                </div>\n\n                <div className=\"d-flex align-items-center\">\n                  <button\n                    className=\"btn p-0\"\n                    style={{ borderRadius: \"50%\", border: \"none\" }}\n                    type=\"submit\"\n                    // disabled={loginLoading}\n                  >\n                    <ReadyRoundIcon width={30} height={30} fill={ICON_COLOR} />\n                  </button>\n                </div>\n                <div className=\"mt-4 text-center\"></div>\n              </Form>\n            )}\n          </Formik>\n        </div>\n      </div>\n      <ConfimrDialog\n        open={isOpen}\n        title={\"Confirm delete?\"}\n        message={\"Deleted content cannot be recovered.\"}\n        onCancel={() => {\n          setPendingAction(undefined);\n          setIsOpen(false);\n        }}\n        onConfirm={() => {\n          handleOptions();\n        }}\n      />\n      <ConfimrDialog\n        open={newRoomDialog}\n        title={\"Add new room\"}\n        message={\"Please input room name.\"}\n        withInput\n        onCancel={() => {\n          setNewRoomDialog(false);\n        }}\n        onConfirm={(e) => {\n          handleAddNewRoom(e);\n        }}\n      />\n      <ConfimrDialog\n        open={joinRoomDialog}\n        title={\"Join room\"}\n        message={\"Please input Room ID to join a room.\"}\n        withInput\n        onCancel={() => {\n          setJoinRoomDialog(false);\n        }}\n        onConfirm={(e) => {\n          handleJoinRoom(e);\n        }}\n      />\n    </div>\n  );\n};\n"],"names":["Schema","Yup","shape","msg","required","ICON_COLOR","CHAT_TOP_HEIGHT","ICON_SIZE","ChatPage","user","useSelector","rootState","auth","dispatch","useDispatch","isMobile","useMediaQuery","query","useState","visible","setVisible","isOpen","setIsOpen","pendingAction","setPendingAction","showRooms","setShowRooms","activeRoom","setActiveRoom","rooms","setRooms","newRoomDialog","setNewRoomDialog","joinRoomDialog","setJoinRoomDialog","paddingBottom","setPaddingBottom","rows","setRows","collection","db","orderBy","limit","querying","setQuerying","headerRef","useRef","scrollRef","useEffect","messages","useFirestoreQuery","setActiveRoute","window","scrollTo","top","document","body","scrollHeight","behavior","current","getTotalRooms","useCallback","q","where","uid","getDocs","querySnapshot","roomTotal","forEach","doc","push","id","data","windowScroll","_","e","scrollTop","scrollY","clientHeight","innerHeight","addEventListener","removeEventListener","handleScroll","target","handleAddNewRoom","room","addDoc","name","members","newRoom","displayName","photoURL","message","createdAt","Timestamp","handleJoinRoom","roomRef","getDoc","roomData","exists","includes","updateDoc","toast","onSubmit","values","actions","trimmed","trim","length","_q","resetForm","deleteChatItem","deleteDoc","className","style","minHeight","onClick","borderRadius","width","height","zIndex","Peoples","fill","PlusRound","Search","fontSize","left","map","item","index","ArrowRightLine","navigator","clipboard","writeText","Copy","transform","paddingTop","ref","opacity","svg","size","color","onScroll","self","avatar","onPress","action","initialValues","validationSchema","onChange","onInputChange","_rows","setTimeout","handleRows","split","backgroundColor","border","caretColor","resize","placeholder","type","showError","ReadyRound","open","title","onCancel","undefined","onConfirm","withInput"],"sourceRoot":""}