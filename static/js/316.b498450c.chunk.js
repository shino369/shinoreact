"use strict";(self.webpackChunkshinoreact=self.webpackChunkshinoreact||[]).push([[316],{54316:function(e,t,n){n.r(t),n.d(t,{ChatPage:function(){return J}});var i=n(42982),s=n(74165),o=n(1413),r=n(15861),a=n(70885),c=n(72791),l=n(59434),d=n(39478),u=n(24805),m=n(12075),h=n(84517),f=n(82637),x=n(76277),p=n(8100),b=n(97796),v=n(55705),g=n(81724),w=n(9062),j=n(18643),y=n(763),Z=n.n(y),N=n(80922),k=n(79884),C=n(60196),I=n(75985),R=n(80184),S=g.Ry().shape({msg:g.Z_().required("required")}),z="#fff",E="3.5rem",T=15,J=function(){var e=(0,l.v9)((function(e){return e.auth})).user,t=(0,l.I0)(),n=(0,u.useMediaQuery)({query:"(max-width: 576px)"}),g=(0,c.useState)([]),y=(0,a.Z)(g,2),J=(y[0],y[1],(0,c.useState)(!1)),H=(0,a.Z)(J,2),A=H[0],L=H[1],U=(0,c.useState)(!1),P=(0,a.Z)(U,2),X=P[0],O=P[1],q=(0,c.useState)(),D=(0,a.Z)(q,2),Q=D[0],K=D[1],Y=(0,c.useState)(!n),B=(0,a.Z)(Y,2),F=B[0],M=B[1],V=(0,c.useState)("public"),W=(0,a.Z)(V,2),_=W[0],G=W[1],$=(0,c.useState)([]),ee=(0,a.Z)($,2),te=ee[0],ne=ee[1],ie=(0,c.useState)(!1),se=(0,a.Z)(ie,2),oe=se[0],re=se[1],ae=(0,c.useState)(!1),ce=(0,a.Z)(ae,2),le=ce[0],de=ce[1],ue=(0,c.useState)(n?"7rem":"1rem"),me=(0,a.Z)(ue,2),he=me[0],fe=me[1],xe=(0,c.useState)(1),pe=(0,a.Z)(xe,2),be=pe[0],ve=pe[1],ge=(0,c.useState)((0,w.IO)((0,w.hJ)(j.db,"messages"),(0,w.Xo)("createdAt"),(0,w.b9)(100))),we=(0,a.Z)(ge,2),je=we[0],ye=we[1],Ze=(0,c.useRef)(null),Ne=(0,c.useRef)(null);(0,c.useEffect)((function(){ye("public"===_?(0,w.IO)((0,w.hJ)(j.db,"messages"),(0,w.Xo)("createdAt"),(0,w.b9)(100)):(0,w.IO)((0,w.hJ)(j.db,"rooms",_,"messages"),(0,w.Xo)("createdAt"),(0,w.b9)(100)))}),[_]);var ke=(0,N.sQ)(je);(0,c.useEffect)((function(){t((0,d.wC)("chat"))}),[t]),(0,c.useEffect)((function(){n?window.scrollTo({top:document.body.scrollHeight,behavior:"smooth"}):Ne.current.scrollTo({top:Ne.current.scrollHeight,behavior:"smooth"})}),[ke]);var Ce=(0,c.useCallback)((0,r.Z)((0,s.Z)().mark((function t(){var n,i,r;return(0,s.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=(0,w.IO)((0,w.hJ)(j.db,"rooms"),(0,w.ar)("members","array-contains",e.uid)),t.next=3,(0,w.PL)(n);case 3:i=t.sent,r=[],i.forEach((function(e){r.push((0,o.Z)({id:e.id},e.data()))})),ne(r);case 7:case"end":return t.stop()}}),t)}))),[e]);(0,c.useEffect)((function(){Ce()}),[_,Ce]),(0,c.useEffect)((function(){var e=Z().debounce((function(e){if(n){var t=window.scrollY,i=document.body.scrollHeight,s=window.innerHeight;L(t+s+200<i)}}),100);return window.addEventListener("scroll",e),function(){window.removeEventListener("scroll",e)}}),[]);var Ie=Z().debounce((function(e){if(!n){var t=e.target.scrollTop,i=e.target.scrollHeight,s=e.target.clientHeight;L(t+s+200<i)}}),100),Re=(0,c.useCallback)(function(){var t=(0,r.Z)((0,s.Z)().mark((function t(n){var i;return(0,s.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,(0,w.ET)((0,w.hJ)(j.db,"rooms"),{name:n,members:[e.uid]});case 2:return i=t.sent,t.next=5,(0,w.ET)((0,w.hJ)(j.db,"rooms",i.id,"messages"),{uid:e.uid,displayName:e.displayName,photoURL:e.photoURL,message:"Welcome to the room",createdAt:w.EK.now()});case 5:re(!1),G(i.id);case 7:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),[e]),Se=(0,c.useCallback)(function(){var t=(0,r.Z)((0,s.Z)().mark((function t(n){var o,r,a;return(0,s.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return o=(0,w.JU)(j.db,"rooms",n),t.next=3,(0,w.QT)(o);case 3:if(!(r=t.sent).exists()){t.next=16;break}if(!(a=r.data().members).includes(e.uid)){t.next=11;break}G(n),de(!1),t.next=14;break;case 11:return t.next=13,(0,w.r7)(o,{members:[].concat((0,i.Z)(a),[e.uid])});case 13:G(n);case 14:t.next=17;break;case 16:I.Am.error("Room not found");case 17:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),[e]),ze=function(){var t=(0,r.Z)((0,s.Z)().mark((function t(n,i){var o,r,a,c;return(0,s.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(o=n.msg,!((r=o.trim()).length>0)){t.next=8;break}return a="public"===_?(0,w.hJ)(j.db,"messages"):(0,w.hJ)(j.db,"rooms",_,"messages"),c={uid:e.uid,displayName:e.displayName,photoURL:e.photoURL,message:r,createdAt:w.EK.now()},t.next=7,(0,w.ET)(a,c);case 7:t.sent;case 8:i.resetForm();case 9:case"end":return t.stop()}}),t)})));return function(e,n){return t.apply(this,arguments)}}(),Ee=(0,c.useCallback)(function(){var e=(0,r.Z)((0,s.Z)().mark((function e(t){return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("public"!==_){e.next=6;break}return e.next=3,(0,w.oe)((0,w.JU)(j.db,"messages",t));case 3:e.sent,e.next=9;break;case 6:return e.next=8,(0,w.oe)((0,w.JU)(j.db,"rooms",_,"messages",t));case 8:e.sent;case 9:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),[_]);return(0,R.jsxs)("div",{className:"d-flex justify-content-center chatroom-wrapper px-sm-4 pt-sm-3 pb-sm-5",children:[(0,R.jsx)("div",{className:"".concat(n?"d-none":""," start-0 h-100 d-flex align-items-start justify-content-start bg-room overflow-hidden"),children:(0,R.jsxs)("div",{className:"p-0 d-flex flex-column h-100 justify-content-start position-relative",children:[(0,R.jsxs)("div",{className:"d-flex align-items-center",style:{minHeight:E},children:[(0,R.jsx)("div",{onClick:function(){M(!F)},className:"d-sm-none btn ms-1 mt-1 bg-dark pointer hover-opacity p-0 d-flex justify-content-center align-items-center",style:{borderRadius:"50%",width:30,height:30,zIndex:20},children:(0,R.jsx)(h.Z,{width:T,height:T,fill:z})}),(0,R.jsx)("div",{onClick:function(){re(!0)},className:"".concat(F?"":"d-none"," btn ms-1 bg-dark mt-1 pointer hover-opacity p-0 d-flex justify-content-center align-items-center"),style:{borderRadius:"50%",width:30,height:30,zIndex:20},children:(0,R.jsx)(f.Z,{width:T,height:T,fill:z})}),(0,R.jsx)("div",{onClick:function(){de(!0)},className:"".concat(F?"":"d-none"," btn ms-1 bg-dark mt-1 pointer hover-opacity p-0 d-flex justify-content-center align-items-center"),style:{borderRadius:"50%",width:30,height:30,zIndex:20},children:(0,R.jsx)(x.Z,{width:T,height:T,fill:z})})]}),(0,R.jsx)("div",{className:"transition me-1 overflow-scroll",style:{width:"8rem",fontSize:"0.75rem",left:"0px",zIndex:10},children:[{name:"public",id:"public"}].concat((0,i.Z)(te)).map((function(e,t){return(0,R.jsxs)("div",{className:"mb-1 text-white p-0 text-start w-100",children:[(0,R.jsxs)("div",{onClick:function(){_!==e.id&&G(e.id),n&&M(!1)},className:"px-2 bg-chat pointer d-flex w-100 justify-content-between align-items-center",children:[(0,R.jsx)("div",{className:"col",children:e.name}),(0,R.jsx)("div",{className:"col-2 py-2",children:(0,R.jsx)(b.Z,{width:20,height:20,fill:z})})]}),"public"!==e.id&&(0,R.jsxs)("div",{className:"px-2 d-flex align-items-center",children:[(0,R.jsx)("div",{className:"text-break col",children:e.id}),(0,R.jsx)("div",{onClick:function(){navigator.clipboard.writeText(e.id)},className:"col-2 d-flex justify-content-end pointer",children:(0,R.jsx)(p.Z,{width:T,height:T,fill:z})})]})]},t)}))})]})}),(0,R.jsxs)("div",{className:"chatroom shadow d-flex flex-column position-relative ".concat(n?"":"overflow-hidden"),children:[(0,R.jsx)("div",{onClick:function(){M(!F)},className:"".concat(F&&n?"":"d-none"," backdrop position-absolute w-100 h-100"),style:{zIndex:1010}}),(0,R.jsx)("div",{className:"".concat(n?"position-fixed":"d-none"," start-0 h-100 d-flex align-items-start justify-content-start"),style:{zIndex:1020},children:(0,R.jsxs)("div",{className:"p-0 d-flex ".concat(n?"flex-column align-items-center":"d-flex align-items-start"," h-100 justify-content-start position-relative"),children:[(0,R.jsxs)("div",{className:"d-flex align-items-center",children:[(0,R.jsx)("div",{onClick:function(){M(!F)},className:"btn ms-1 mt-1 bg-dark pointer hover-opacity p-0 d-flex justify-content-center align-items-center",style:{borderRadius:"50%",width:30,height:30,zIndex:20},children:(0,R.jsx)(h.Z,{width:T,height:T,fill:z})}),(0,R.jsx)("div",{onClick:function(){re(!0)},className:"".concat(F?"":"d-none"," btn ms-1 bg-dark mt-1 pointer hover-opacity p-0 d-flex justify-content-center align-items-center"),style:{borderRadius:"50%",width:30,height:30,zIndex:20},children:(0,R.jsx)(f.Z,{width:T,height:T,fill:z})}),(0,R.jsx)("div",{onClick:function(){de(!0)},className:"".concat(F?"":"d-none"," btn ms-1 bg-dark mt-1 pointer hover-opacity p-0 d-flex justify-content-center align-items-center"),style:{borderRadius:"50%",width:30,height:30,zIndex:20},children:(0,R.jsx)(x.Z,{width:T,height:T,fill:z})})]}),(0,R.jsx)("div",{className:"transition shadow pe-1 bg-primary position-absolute h-100",style:{transform:F?"translateX(0)":"translateX(-8rem)",width:"8rem",fontSize:"0.75rem",paddingTop:"4rem",left:"0px",zIndex:10},children:[{name:"public",id:"public"}].concat((0,i.Z)(te)).map((function(e,t){return(0,R.jsxs)("div",{className:"mb-1 text-white p-0 text-start w-100",children:[(0,R.jsxs)("div",{onClick:function(){_!==e.id&&G(e.id),n&&M(!1)},className:"px-2 bg-chat pointer d-flex w-100 justify-content-between align-items-center",children:[(0,R.jsx)("div",{className:"col",children:e.name}),(0,R.jsx)("div",{className:"col-2 py-2",children:(0,R.jsx)(b.Z,{width:20,height:20,fill:z})})]}),"public"!==e.id&&(0,R.jsxs)("div",{className:"px-2 d-flex align-items-center",children:[(0,R.jsx)("div",{className:"text-break col",children:e.id}),(0,R.jsx)("div",{onClick:function(){navigator.clipboard.writeText(e.id)},className:"col-2 d-flex justify-content-end pointer",children:(0,R.jsx)(p.Z,{width:T,height:T,fill:z})})]})]},t)}))})]})}),(0,R.jsx)("div",{ref:Ze,className:"room-title d-none d-sm-flex justify-content-center align-items-center border-bottom text-center shadow",style:{height:E,fontSize:"1rem"},children:"Realtime Chat Room"}),(0,R.jsx)("div",{onClick:function(){n?window.scrollTo({top:document.body.scrollHeight,behavior:"smooth"}):Ne.current.scrollTo({top:Ne.current.scrollHeight,behavior:"smooth"})},style:{borderRadius:"50%",opacity:A?1:0,transform:A?"translateY(0)":"translateX(100%)"},className:"".concat(n?"position-fixed":"position-absolute"," scroll-to pointer bg-dark transition mb-5 mb-sm-0 shadow"),children:(0,R.jsx)(k.JO,{svg:!0,name:"arrow-down",size:20,color:"white"})}),(0,R.jsx)("div",{ref:Ne,onScroll:Ie,className:"room-content hideScroll pt-5 pt-sm-1",style:{paddingBottom:he},children:ke.map((function(t,n){return(0,R.jsx)(k.z5,{name:t.displayName,message:t.message,self:(null===e||void 0===e?void 0:e.uid)===(null===t||void 0===t?void 0:t.uid),avatar:t.photoURL,uid:t.uid,createdAt:t.createdAt,onPress:function(e){K({action:e,id:t.id}),O(!0)}},n)}))}),(0,R.jsx)("div",{className:"border-top pt-3 pb-5 pb-sm-3 input-fixed",style:{zIndex:30},children:(0,R.jsx)(v.J9,{initialValues:{msg:""},validationSchema:S,onSubmit:ze,children:function(e){e.values;return(0,R.jsxs)(v.l0,{className:"d-flex w-100 px-4",onChange:function(){},children:[(0,R.jsx)("div",{className:"col",children:(0,R.jsx)(k.UP,{onInputChange:function(e){""!==e&&e.length>0&&function(e){var t=e>5?5:e;ve(t),n&&fe("".concat(1.5*t+5.5,"rem")),setTimeout((function(){n?window.scrollTo({top:document.body.scrollHeight,behavior:"smooth"}):Ne.current.scrollTo({top:Ne.current.scrollHeight,behavior:"smooth"})}),50)}(e.split("\n").length)},style:{backgroundColor:"rgba(54, 57, 63, 0.8)",border:"none",caretColor:"white",color:"white",resize:"none"},name:"msg",placeholder:"Input something...",type:"textarea",showError:!1,rows:be})}),(0,R.jsx)("div",{className:"d-flex align-items-center",children:(0,R.jsx)("button",{className:"btn p-0",style:{borderRadius:"50%",border:"none"},type:"submit",children:(0,R.jsx)(m.Z,{width:30,height:30,fill:z})})}),(0,R.jsx)("div",{className:"mt-4 text-center"})]})}})})]}),(0,R.jsx)(C.Z,{open:X,title:"Confirm delete?",message:"Deleted content cannot be recovered.",onCancel:function(){K(void 0),O(!1)},onConfirm:function(){Q&&"DELETE"===Q.action&&Ee(Q.id),K(void 0),O(!1)}}),(0,R.jsx)(C.Z,{open:oe,title:"Add new room",message:"Please input room name.",withInput:!0,onCancel:function(){re(!1)},onConfirm:function(e){Re(e)}}),(0,R.jsx)(C.Z,{open:le,title:"Join room",message:"Please input Room ID to join a room.",withInput:!0,onCancel:function(){de(!1)},onConfirm:function(e){Se(e)}})]})}}}]);
//# sourceMappingURL=316.b498450c.chunk.js.map