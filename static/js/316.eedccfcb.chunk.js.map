{"version":3,"file":"static/js/316.eedccfcb.chunk.js","mappings":"8SA6BMA,EAASC,EAAAA,KAAaC,MAAM,CAChCC,IAAKF,EAAAA,KAAaG,SAAS,cAOhBC,EAAW,WACtB,IAAMC,GAAWC,EAAAA,EAAAA,MACTC,GAASC,EAAAA,EAAAA,KAAY,SAACC,GAAD,OAA0BA,EAAUC,QAAzDH,KACR,GAAoCI,EAAAA,EAAAA,UAAgB,IAApD,0BAEAC,EAAAA,EAAAA,YAAU,WACRP,GAASQ,EAAAA,EAAAA,IAAe,WACvB,CAACR,IACJ,IAAMS,GAAKC,EAAAA,EAAAA,KACTC,EAAAA,EAAAA,IAAWC,EAAAA,GAAI,aACfC,EAAAA,EAAAA,IAAQ,cAAcC,EAAAA,EAAAA,IAAM,MAExBC,GAAWC,EAAAA,EAAAA,IAAkBP,GAgC7BQ,EAAQ,yCAAG,WACfC,EACAC,GAFe,mFAIPtB,EAAQqB,EAARrB,OACFuB,EAAUvB,EAAIwB,QACRC,OAAS,GANN,uBAOFX,EAAAA,EAAAA,IAAWC,EAAAA,GAAI,YAEpBW,EAAU,CACdC,IAAKtB,EAAMsB,IACXC,YAAavB,EAAMuB,YACnBC,SAAUxB,EAAMwB,SAChBH,QAASH,EACTO,UAAWC,EAAAA,GAAAA,OAdA,UAgBQC,EAAAA,EAAAA,KAAOlB,EAAAA,EAAAA,IAAWC,EAAAA,GAAI,YAAaW,GAhB3C,qBAmBfJ,EAAQW,YACRC,QAAQC,IAAI,SAAUd,GApBP,4CAAH,wDAwBd,OACE,gBAAKe,UAAU,qDAAf,UACE,iBAAKA,UAAU,6DAAf,WACE,gBAAKA,UAAU,mDAAf,kCAIA,gBAAKA,UAAU,0BAAf,SACGlB,EAASmB,KAAI,SAACC,EAAMC,GAAP,OACZ,SAAC,KAAD,CAEEC,KAAMF,EAAKE,KACXd,QAASY,EAAKZ,QACde,MAAU,OAAJpC,QAAI,IAAJA,OAAA,EAAAA,EAAMsB,QAAN,OAAcW,QAAd,IAAcA,OAAd,EAAcA,EAAMX,KAC1Be,OAAQJ,EAAKT,SACbF,IAAKW,EAAKX,IACVG,UAAWQ,EAAKR,WANXS,SAUX,gBAAKH,UAAU,kBAAf,UACE,SAAC,KAAD,CACEO,cAAe,CACb3C,IAAK,IAEP4C,iBAAkB/C,EAClBuB,SAAUA,EALZ,SAOG,kBACC,UAAC,KAAD,CAAMgB,UAAU,oBAAhB,WACE,gBAAKA,UAAU,MAAf,UACE,SAAC,KAAD,CACEI,KAAK,MACLK,YAAY,qBACZC,KAAK,OACLC,WAAW,OAIf,gBAAKX,UAAU,GAAf,UACE,mBACEA,UAAU,4BACVU,KAAK,SAFP,qBAQF,gBAAKV,UAAU","sources":["app/pages/chat/index.tsx"],"sourcesContent":["// import { useCallback, useEffect, useState } from 'react';\r\n\r\nimport { useCallback, useEffect, useState } from \"react\";\r\nimport { useDispatch, useSelector } from \"react-redux\";\r\nimport { Link } from \"react-router-dom\";\r\nimport { setActiveRoute } from \"store/activeRoute\";\r\nimport {\r\n  addDoc,\r\n  collection,\r\n  doc,\r\n  getDoc,\r\n  getDocs,\r\n  limit,\r\n  onSnapshot,\r\n  orderBy,\r\n  query,\r\n  Timestamp,\r\n  where,\r\n} from \"firebase/firestore\";\r\nimport { db } from \"app/hooks/firebase\";\r\nimport { RootState } from \"store\";\r\nimport moment from \"moment\";\r\nimport { Input, Table } from \"reactstrap\";\r\nimport { useFirestoreQuery } from \"app/hooks/commonHook\";\r\nimport \"./index.scss\";\r\nimport { ChatItem, InputField } from \"app/components\";\r\nimport { Form, Formik, FormikHelpers } from \"formik\";\r\nimport * as Yup from \"yup\";\r\n\r\nconst Schema = Yup.object().shape({\r\n  msg: Yup.string().required(\"required\"),\r\n});\r\n\r\ntype FormItem = {\r\n  msg: string;\r\n};\r\n\r\nexport const ChatPage = () => {\r\n  const dispatch = useDispatch();\r\n  const { user } = useSelector((rootState: RootState) => rootState.auth);\r\n  const [newMessage, setNewMessage] = useState<any[]>([]);\r\n\r\n  useEffect(() => {\r\n    dispatch(setActiveRoute(\"chat\"));\r\n  }, [dispatch]);\r\n  const _q = query(\r\n    collection(db, \"messages\"),\r\n    orderBy(\"createdAt\"), limit(100)\r\n  );\r\n  const messages = useFirestoreQuery(_q);\r\n\r\n  // useEffect(() => {\r\n\r\n  //   const _q = query(collection(db, \"messages\"), orderBy(\"createdAt\"), limit(100));\r\n  //   const unsubscribe = onSnapshot(_q, (snapshot) => {\r\n  //     const data = snapshot.docs.map(\r\n  //       (doc) => ({\r\n  //         ...doc.data(),\r\n  //         id: doc.id,\r\n  //       })\r\n  //     )\r\n  //     // snapshot.docChanges().forEach((change) => {\r\n  //     //   if (change.type === \"added\") {\r\n  //     //     console.log(\"New: \", change.doc.data());\r\n  //     //   }\r\n  //     //   if (change.type === \"modified\") {\r\n  //     //     console.log(\"Modified: \", change.doc.data());\r\n  //     //   }\r\n  //     //   if (change.type === \"removed\") {\r\n  //     //     console.log(\"Removed: \", change.doc.data());\r\n  //     //   }\r\n  //     //   const msg = change.doc.data();\r\n  //     //   setMessages((prev) => [...prev, msg]);\r\n  //     // });\r\n  //   });\r\n\r\n  //   return () => {\r\n  //     unsubscribe();\r\n  //   };\r\n  // }, []);\r\n\r\n  const onSubmit = async (\r\n    values: FormItem,\r\n    actions: FormikHelpers<FormItem>\r\n  ) => {\r\n    const { msg } = values;\r\n    const trimmed = msg.trim();\r\n    if (trimmed.length > 0) {\r\n      const _q = collection(db, \"messages\");\r\n\r\n      const message = {\r\n        uid: user!.uid,\r\n        displayName: user!.displayName,\r\n        photoURL: user!.photoURL,\r\n        message: trimmed,\r\n        createdAt: Timestamp.now(),\r\n      };\r\n      const docRef = await addDoc(collection(db, \"messages\"), message);\r\n\r\n    }\r\n    actions.resetForm();\r\n    console.log(\"values\", values);\r\n    // submit to firebase\r\n  };\r\n\r\n  return (\r\n    <div className=\"d-flex justify-content-center chatroom-wrapper p-4\">\r\n      <div className=\"chatroom rounded overflow-hidden shadow d-flex flex-column\">\r\n        <div className=\"room-title border-bottom text-center py-3 shadow\">\r\n          Real-Time Chat Room\r\n        </div>\r\n\r\n        <div className=\"room-content hideScroll\">\r\n          {messages.map((item, index) => (\r\n            <ChatItem\r\n              key={index}\r\n              name={item.name}\r\n              message={item.message}\r\n              self={user?.uid === item?.uid}\r\n              avatar={item.photoURL}\r\n              uid={item.uid}\r\n              createdAt={item.createdAt}\r\n            />\r\n          ))}\r\n        </div>\r\n        <div className=\"border-top pt-3\">\r\n          <Formik\r\n            initialValues={{\r\n              msg: \"\",\r\n            }}\r\n            validationSchema={Schema}\r\n            onSubmit={onSubmit}\r\n          >\r\n            {() => (\r\n              <Form className=\"d-flex w-100 px-4\">\r\n                <div className=\"col\">\r\n                  <InputField\r\n                    name=\"msg\"\r\n                    placeholder=\"Input something...\"\r\n                    type=\"text\"\r\n                    showError={false}\r\n                  />\r\n                </div>\r\n\r\n                <div className=\"\">\r\n                  <button\r\n                    className=\"btn btn-primary btn-block\"\r\n                    type=\"submit\"\r\n                    // disabled={loginLoading}\r\n                  >\r\n                    SEND\r\n                  </button>\r\n                </div>\r\n                <div className=\"mt-4 text-center\"></div>\r\n              </Form>\r\n            )}\r\n          </Formik>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n"],"names":["Schema","Yup","shape","msg","required","ChatPage","dispatch","useDispatch","user","useSelector","rootState","auth","useState","useEffect","setActiveRoute","_q","query","collection","db","orderBy","limit","messages","useFirestoreQuery","onSubmit","values","actions","trimmed","trim","length","message","uid","displayName","photoURL","createdAt","Timestamp","addDoc","resetForm","console","log","className","map","item","index","name","self","avatar","initialValues","validationSchema","placeholder","type","showError"],"sourceRoot":""}